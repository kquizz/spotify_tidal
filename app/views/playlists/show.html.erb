<div class="max-w-7xl mx-auto">
  <div class="relative mb-12 fade-in">
    <!-- Blurred Background -->
<div class="max-w-5xl mx-auto">
  <div class="mb-8 fade-in backdrop-blur-xl bg-white/5 border border-white/10 rounded-3xl overflow-hidden shadow-2xl">
    <div class="p-8">
      <div class="relative">
        <!-- Blurred Background -->
        <div class="absolute inset-0 -z-10 overflow-hidden rounded-2xl">
          <% if @playlist.image_url %>
            <img src="<%= @playlist.image_url %>" class="w-full h-full object-cover blur-3xl opacity-20 scale-110">
          <% else %>
            <div class="w-full h-full bg-gradient-to-br from-cyan-900/40 to-purple-900/40 blur-3xl opacity-30"></div>
          <% end %>
          <div class="absolute inset-0 bg-gradient-to-b from-transparent via-[#09090b]/80 to-[#09090b]"></div>
        </div>

        <div class="flex flex-col md:flex-row items-end gap-8 p-8 md:p-12">
          <div class="flex-shrink-0 relative group">
            <% if @playlist.image_url %>
              <img src="<%= @playlist.image_url %>" alt="<%= @playlist.name %>" class="w-52 h-52 md:w-64 md:h-64 rounded-2xl object-cover shadow-[0_0_40px_rgba(0,0,0,0.6)] group-hover:scale-105 transition-transform duration-500">
            <% else %>
              <div class="w-52 h-52 md:w-64 md:h-64 rounded-2xl bg-gradient-to-br from-gray-800 to-gray-900 flex items-center justify-center shadow-2xl group-hover:scale-105 transition-transform duration-500 border border-white/10">
                <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="text-gray-600">
                  <path d="M9 18V5l12-2v13"></path>
                  <circle cx="6" cy="18" r="3"></circle>
                  <circle cx="18" cy="16" r="3"></circle>
                </svg>
              </div>
            <% end %>
          </div>
          
          <div class="flex-1 text-center md:text-left pb-2">
            <p class="text-xs md:text-sm text-cyan-400 uppercase tracking-widest font-bold mb-2">Playlist</p>
            <h1 class="text-4xl md:text-6xl lg:text-7xl font-bold mb-6 text-white tracking-tight leading-tight"><%= @playlist.name %></h1>
            <div class="flex flex-wrap items-center justify-center md:justify-start gap-6 text-gray-300 font-medium">
              <span class="flex items-center gap-2 bg-white/5 px-3 py-1 rounded-full border border-white/5 backdrop-blur-md">
                <div class="w-6 h-6 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-[10px] font-bold text-white">
                  <%= @playlist.owner[0].upcase %>
                </div>
                <%= @playlist.owner %>
              </span>
              <span class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500">
                  <path d="M9 18V5l12-2v13"></path>
                  <circle cx="6" cy="18" r="3"></circle>
                  <circle cx="18" cy="16" r="3"></circle>
                </svg>
                <%= @playlist.tracks_total %> tracks
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="flex flex-wrap justify-center md:justify-start gap-4 mb-10 px-8 fade-in" style="animation-delay: 0.1s;">
    <% if Current.user.tidal_connected? %>
      <%= button_to lookup_tracks_playlist_path(@playlist), method: :post, class: "group relative px-6 py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-full text-white font-medium transition-all duration-300 overflow-hidden" do %>
        <div class="absolute inset-0 bg-gradient-to-r from-cyan-500/10 to-purple-500/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
        <span class="relative flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-cyan-400">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          Lookup Tracks
        </span>
      <% end %>

      <%= button_to sync_to_tidal_playlist_path(@playlist), method: :post, class: "group relative px-8 py-3 bg-cyan-500 hover:bg-cyan-400 text-black font-bold rounded-full transition-all duration-300 shadow-[0_0_20px_rgba(6,182,212,0.3)] hover:shadow-[0_0_30px_rgba(6,182,212,0.5)] hover:-translate-y-0.5" do %>
        <span class="flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
            <path d="m21 2-2 2 4 4"></path>
            <path d="m21 2-7 7"></path>
          </svg>
          Create Playlist on Tidal
        </span>
      <% end %>
      <% if @playlist.import_status == 'failed' || @playlist.import_status == 'pending' %>
        <%= button_to retry_import_playlist_path(@playlist), method: :post, class: "group relative px-6 py-3 bg-yellow-400 hover:bg-yellow-300 text-black font-bold rounded-full transition-all duration-300" do %>
          Retry Import
        <% end %>
      <% end %>
    <% else %>
      <%= link_to "/auth/tidal", class: "group relative px-8 py-3 bg-white text-black font-bold rounded-full transition-all duration-300 shadow-[0_0_20px_rgba(255,255,255,0.2)] hover:shadow-[0_0_30px_rgba(255,255,255,0.4)] hover:-translate-y-0.5" do %>
        <span class="flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M15 3h6v18h-6M10 17l5-5-5-5M13.8 12H3"/>
          </svg>
          Connect Tidal Account
        </span>
      <% end %>
    <% end %>
  </div>

  <% if @playlist.last_import_error.present? %>
    <div class="max-w-5xl mx-auto mb-6 px-8">
      <div class="p-4 bg-red-500/10 border border-red-500/20 text-red-300 rounded-lg">
        <strong class="text-red-200">Import error:</strong>
        <div class="mt-1 text-sm break-words flex items-start gap-3">
          <div class="flex-1 truncate"><%= @playlist.last_import_error %></div>
          <button data-action="click->error-modal#open" data-error="<%= j @playlist.last_import_error %>" class="ml-2 text-xs text-white bg-red-500/80 px-3 py-1 rounded">View</button>
        </div>
      </div>
    </div>
  <% end %>

  <!-- Error Modal -->
  <div data-controller="error-modal" data-error-modal-target="modal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
    <div class="absolute inset-0 bg-black/60" data-action="click->error-modal#close"></div>
    <div class="bg-white max-w-2xl w-full rounded-lg p-6 z-10">
      <h3 class="text-lg font-bold mb-2">Import error details</h3>
      <pre data-error-modal-target="content" class="whitespace-pre-wrap text-sm text-gray-800 p-2 bg-gray-100 rounded h-48 overflow-auto"></pre>
      <div class="mt-4 flex gap-3 justify-end">
        <button type="button" data-action="click->error-modal#copy" class="px-4 py-2 bg-green-500 text-white rounded">Copy</button>
        <button type="button" data-action="click->error-modal#close" class="px-4 py-2 bg-gray-200 rounded">Close</button>
      </div>
    </div>
  </div>

  <div class="backdrop-blur-xl bg-white/5 border border-white/5 rounded-3xl overflow-hidden mx-4 md:mx-0 mb-20 fade-in shadow-2xl" style="animation-delay: 0.2s;">
    <div class="divide-y divide-white/5">
      <% @playlist.songs.each do |song| %>
        <%= render "shared/song_line", song: song %>
      <% end %>
    </div>
  </div>
</div>
